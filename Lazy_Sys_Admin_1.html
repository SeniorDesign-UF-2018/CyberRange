<!DOCTYPE HTML>
<html lang="en">
  <head>
    <meta content="text/html" charset="utf-8">
    <meta name="Cyber Range" content="penetration testing">
    <title>Kioptrix Level 1</title>
    <!-- stylsheets needed -->
    <link rel="stylesheet" href="Walkthrough.css">
  </head>

  <body>
    <!-- Branding Area ofthe webpage that contains banner image -->
    <!-- Also toolbar could go here -->
    <div id="header">
        <div id="logoBox"></div>
        <ul id="nav-list">
          <li><a href="index.html">Home</a></li>
          <li><a class="active" href="TutorialPage.html">Tutorials</a></li>
          <li><a href="About.html">About</a></li>
        </ul>
    </div>

    <!-- container that holds all of the contents of webpage -->
    <div id="page-container">

      <h1>Lazy Sys Admin 1</h1>

      <div id="content">
        <!-- Walkthrough content is held here -->
        <p>The first step in the process of attaining root when all that is known is that the target server is a part of the same network you are on is typically to discover the IP address of the victim machine. That will be attacked until full root access is achieved but first it is necessary to collect information using multiple tools. In this case the network scanning tool netdiscover will be used by executing the command below in the terminal but be advised this might take up to a couple of minutes.</p>
        <p><span class="blue-highlight">netdiscover -I eth0</span></p>
        <img src="./images/Lazy_Sys_Admin_1/pic1.png" height="400" width="900">
        <p>The <span class="blue-highlight">-I</span> argument is what is used to specify the network device/interface to be scanned so the inclusion of <span class="blue-highlight">-I eth0</span> means that the first ethernet device is what is being scanned. In the case of wireless devices, the argument <span class="blue-highlight">-l wlan0</span> would be used. If there are multiple of the same type of networking devices <span class="blue-highlight">-I eth1</span> would scan the secondary ethernet interface and <span class="blue-highlight">-l  wlan1</span> would specify the next wireless device. Netdiscover is also capable of being run without arguments, this causes it to auto-scan across deferent devices for IP Addresses, live hosts, MAC addresses and MAC vendors.</p>
        <p>Now that the IP address of the target is known it can be used as an argument to the tool Nmap which will be used to scan the machine at an address for ports that are open and what is using the port. The current connections represented by those open ports can be analyzed for possible ways they could be of use in exploiting the target machine to vulnerabilities that can aid in getting a shell up and eventually escalating our privilege up to root. Execute the following command in the terminal to use Nmap to scan the ports: <span class="blue-highlight">nmap -T4 -A -v 192.168.1.100</span> Please note that this scan is noisy, aggressive and might set off red flags in practice on a real network but since this is happening on the private internal network you created there is no risk or need for subtlety.</p>
        <p><span class="blue-highlight">nmap -T4 -A -v 192.168.1.100</span></p>
        <img src="./images/Lazy_Sys_Admin_1/pic2.png" height="400" width="900">
        <p>The ports that are open as shown in the screen shot up above are 22, 80, 445, 3306 and 6667. On port 6667 there is an irc server run by InspIRCd. Port 3306 contains an unauthorized MySQL data base. Port 445 is the Sever Message Block (SMB) which provides inter process communication, shared access to files and devices while also aiding in the communication between nodes. Port 139 is the NetBIOS over TCP/IP (NBT), this allows older legacy machines to have access to TCP/IP networks.  On port 80 there is an Apache web sever running with four disallowed entries according to http-robots.txt (directories: /old/ /test/ /TR2/ /Backnode_files/) which might be of use later. The last port that is open is Port 22 and it is being used for SSH.</p>
        <p>DIRB is a web content scanner that, in addition to searching for web objects including those that are hidden it can also launches a dictionary-based attack to analyzes web servers and how they respond to the attack. The fallowing command will locate hidden directories web objects on the machine (this may take a while):</p>
        <p><span class="blue-highlight">dirb http://192.168.1.100</span></p>
        <img src="./images/Lazy_Sys_Admin_1/pic3.png" height="400" width="900">
        <p>This has reviled that in the /phpmyadmin/ directory there is a file called <span class="blue-highlight">index.php</span>, the /apache/ directory contains <span class="blue-highlight">info.php</span>, in /phpmyadmin/locale/ there is a file called <span class="blue-highlight">phpinfo.php</span> and that the /wordpress/ directory is a WordPress blog with the file <span class="blue-highlight">wp-config.php</span>. To see the web site, open a web browser and enter in the IP address of the web server fallowed by /wordpress/ for example in this case it would be <span class="blue-highlight">192.168.1.100/wordpress/</span> as shown below:</p>
        <img src="./images/Lazy_Sys_Admin_1/pic4.png" height="400" width="900">
        <p>Note that this web padge states: “My name is togie” multiple times. This information will be useful later.</p>
        <p>Next the wpscan tool will be used to scan the site for any vulnerabilities. This is done with the following command:</p>
        <p><span class="blue-highlight">wpscan --url http://192.168.59.129</span></p>
        <img src="./images/Lazy_Sys_Admin_1/pic5.png" height="400" width="900">
        <p>This has revealed that that this WordPress has a version number of 4.8.2. This version happens to be vulnerable to a password reset exploit but that won’t be needed in this case.</p>
        <p>Enum4linux is a tool that enumerates data from hosts that might contain information that can be usefull in determining the avenues of attack most likely to succeed. This is capable of enumerating windows and Samba hosts. Enter the following command into the terminal to use it:</p>
        <p><span class="blue-highlight">enum4linux -a 192.168.59.129</span></p>
        <img src="./images/Lazy_Sys_Admin_1/pic6.png" height="400" width="900">
        <p>This shows that the server is running Samba and in the Share Enumeration section it is shown that share folder is active and allowed its contents to be listed with read only access. To connect and explore this shared folder smbclient will be used since it is a tool that allows for easy interfacing with Samba servers inside of the terminal using the command <span class="blue-highlight">smbclient //192.168.59.129/share$</span>.
          The Kali file browser would also work in viewing this shared folder so for simplicity it will be used here over smbclient. To open the shared folder, open the file browser, click on “other locations” on the left enter <span class="blue-highlight">smb:// 192.168.59.129</span> in the bottom connect to server bar, then hit the connect button while making sure the anonymous option is selected and finally double click on the shared folder to see the web root of this server. The following is what it should look like in the file browser:<p>
        <img src="./images/Lazy_Sys_Admin_1/pic7.png" height="400" width="900">
        <p>Look inside of the todolist.txt file to learn that in this case using the local file browser would allow users to view the web root. Look inside the <span class="blue-highlight">deets.txt</span> file to learn that the password for togie on the web server is <span class="blue-highlight">12345</span> and that this file should have been deleted when the server was finished being set up.</p>
        <img src="./images/Lazy_Sys_Admin_1/pic8.png" height="400" width="900">
        <p>Next open the <span class="blue-highlight">wp-config.php</span> in the <span class="blue-highlight">/wordpress</span> directory file and from there the password: <span class="blue-highlight">TogieMYSQL12345^^</span> and username: <span class="blue-highlight">Admin</span> for the database are exposed as shown down below:</p>
        <img src="./images/Lazy_Sys_Admin_1/pic9.png" height="400" width="900">
        <p>Next step is to use those credentials to open PhpMyAdmin try to browse its tables. Although doing so shows that most tables are empty and trying to open table such as wp_users table causes an error due to the storage configuration being incomplete.</p>
        <img src="./images/Lazy_Sys_Admin_1/pic10.png" height="400" width="900">
        <p>People typically like to use the same password across different things because it is easy to remember, using the password <span class="blue-highlight">12345</span> we found earlier in <span class="blue-highlight">deets.txt</span> and the name togie discovered the WordPress site, SSH can be used to access the machine as togie.</p>
        <p><span class="blue-highlight">ssh togie@192.168.59.129</span></p>
        <img src="./images/Lazy_Sys_Admin_1/pic11.png" height="400" width="900">
        <p>If the passwords were different and SSH could not have be used the next logical step would probably be to exploit the WordPress site because the database credentials found in <span class="blue-highlight">wp-config.php</span> username: <span class="blue-highlight">Admin</span> password: <span class="blue-highlight">TogieMYSQL12345^^</span> allow for Administrative access to Wordpress.
          The process would be to inject a php reverse shell inside one of the WordPress php files edited with the correct IP address and port number, set up a listener using netcat on the desired machine while listening on same port specified in the php file, run the shell by using the browser to navigate to the modified php file and then within that new shell that has www-data permissions while running on your machine and then use other exploits to escalate the permission to root.
          This new shell we used SSH to enter is locked down so commands like “cd” are disabled and return only with the message: “cd: restricted” as shown below. Through the use of Python, a less restricted shell can be created with the command:</p>
        <p><span class="blue-highlight">python -c 'import pty; pty.spawn("/bin/sh")'</span></p>
        <img src="./images/Lazy_Sys_Admin_1/pic12.png" height="400" width="900">
        <p>Next use sodu su and then enter the password “12345” to elevate your privileged to root. This will give the user togie the privilege level needed to enter the /root directory where the key is being stored.</p>
        <img src="./images/Lazy_Sys_Admin_1/pic13.png" height="400" width="900">
        <p>Then navigate to the /root directory and check the contents of <span class="blue-highlight">proof.txt</span> to get the key.</p>
        <img src="./images/Lazy_Sys_Admin_1/pic14.png" height="400" width="900">
        <p>Congratulations, you have completed this challenge.</p>
    </div> <!-- End of content div -->
  </div> <!-- End of page-container div -->

    <!-- scripts that are needed to provide functionality -->
    <script src="js/jquery-3.3.1.js" type="text/javascript"></script>

  </body>
</html>
